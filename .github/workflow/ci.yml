name: Monitor Commits

  on:
    push:
      branches:
        - master

  jobs:
    analyze-changes:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout
          uses: actions/checkout@v3
          with:
            fetch-depth: 2  # è·å–æœ€è¿‘ä¸¤æ¬¡æäº¤

        - name: Analyze Commit Diff
          run: |
            echo "ğŸ“Š æäº¤ä¿¡æ¯:"
            git log -1 --pretty=format:"ä½œè€…: %an%næ—¶é—´: %ad%næ¶ˆæ¯: %s%n" --date=iso

            echo ""
            echo "ğŸ“ æ–‡ä»¶å˜æ›´:"
            git diff --stat HEAD~1 HEAD

            echo ""
            echo "ğŸ“ è¯¦ç»†å·®å¼‚:"
            git diff HEAD~1 HEAD

        - name: Python Analysis
          uses: actions/setup-python@v4
          with:
            python-version: '3.x'

        - name: Install Dependencies
          run: pip install PyGithub

        - name: Run Custom Analysis
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          run: |
            python - <<EOF
            from github import Github
            import os

            g = Github(os.environ['GITHUB_TOKEN'])
            repo = g.get_repo(os.environ['GITHUB_REPOSITORY'])

            # è·å–æœ€è¿‘ä¸¤æ¬¡æäº¤
            commits = list(repo.get_commits()[:2])
            if len(commits) >= 2:
                comparison = repo.compare(commits[1].sha, commits[0].sha)
                print(f"æ–‡ä»¶å˜æ›´æ•°: {len(comparison.files)}")
                for file in comparison.files:
                    print(f"{file.status}: {file.filename} (+{file.additions}/-{file.deletions})")
            EOF
